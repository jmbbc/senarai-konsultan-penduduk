<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Senarai Perkhidmatan Penduduk Banjaria Court</title>

  <!-- Google Font (Inter) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            page: '#F7FBF9',
            panel: '#E8F3EE',
            accent: '#BFDCC4',
            'accent-dark': '#A6C9AD',
            muted: '#8B9B92'
          },
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui']
          }
        }
      }
    }
  </script>

  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
  </style>
</head>
<body class="min-h-screen bg-page text-black antialiased">

  <header class="bg-panel shadow-sm">
    <div class="max-w-4xl mx-auto px-4 py-4">
      <h1 class="text-center text-2xl font-extrabold tracking-wide text-black">Senarai Perkhidmatan Penduduk Banjaria Court</h1>
    </div>
  </header>

 <main class="max-w-4xl mx-auto px-4 py-6">
  <section class="bg-panel rounded-lg p-5 mb-6 border border-accent/30 shadow-sm text-justify">
    <p class="font-semibold text-slate-800">Konsultan Profesional Penduduk Banjaria Court</p>

    <p class="mt-2 text-slate-700 text-sm leading-relaxed">
      Ramai dalam kalangan penduduk Banjaria Court memiliki kepakaran dalam pelbagai bidang profesional. Perkhidmatan mereka sering diperlukan oleh komuniti kita.
    </p>

    <p class="mt-2 text-slate-700 text-sm leading-relaxed">
      Inisiatif ini bertujuan memudahkan rujukan tempatan, menjimatkan masa, dan menggalakkan semangat kejiranan.
    </p>
  </section>
</main>



    <section class="flex flex-col sm:flex-row sm:items-center gap-3 mb-6">
      <a href="https://forms.gle/BsTZ2z81Q4XR8zHw6" target="_blank"
         class="inline-block w-full sm:w-auto text-slate-900 bg-accent hover:bg-accent-dark font-semibold px-4 py-2 rounded-lg text-center shadow-sm">
        ğŸ“ Daftar Perkhidmatan
      </a>

      <a id="shareLink" href="#"
         class="inline-block w-full sm:w-auto bg-gradient-to-r from-accent/90 to-accent-dark hover:from-accent-dark hover:to-accent text-slate-900 font-semibold px-4 py-2 rounded-lg text-center shadow-sm">
        ğŸ”— Kongsi via WhatsApp
      </a>
    </section>

    <!-- Statistik ringkas: Jumlah -->
    <section id="statistikRingkas" class="mb-6">
      <div class="bg-panel rounded-lg p-5 mb-6 border border-accent/30 shadow-sm text-center">
        <div class="text-sm font-semibold text-slate-700">Jumlah Perkhidmatan Yang Berdaftar</div>
        <div id="jumlahPerkhidmatan" class="mt-2 text-3xl font-extrabold text-black">â€”</div>
      </div>
    </section>

    <section class="mb-6">
      <label for="bidangSelect" class="block text-sm text-slate-700 mb-2">Tapis ikut bidang:</label>
      <select id="bidangSelect" class="w-full sm:w-64 bg-white border border-panel/60 text-slate-800 p-2 rounded-md shadow-sm">
        <option value="Semua">Semua</option>
      </select>
    </section>

    <section class="mb-12">
      <div id="directory" class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3"></div>
    </section>
  </main>

  <script>
    // escapeHTML helper
    function escapeHTML(str){
      if(!str) return '';
      return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    // Statistik CSV URL (anda sudah publish CSV)
    const statistikUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaIC8vSqefzEVD6ndgQecCNLOb-mNdCtUZMAC_ojDvgDD-mCAnPBVgdLfYlUW7ehK73e8-1KIl4AKZ/pub?gid=2034381075&single=true&output=csv";

    // Ambil B1 dari CSV yang dipublish dan paparkan dalam kad Statistik
    fetch(statistikUrl)
      .then(r => { if(!r.ok) throw new Error('Gagal muat statistik'); return r.text(); })
      .then(csvText => {
        const lines = csvText.trim().split(/\r?\n/);
        function extractFromLine(line) {
          // split mudah; jika CSV mengandungi koma dalam sel, gunakan parser (papaparse)
          const cols = line.split(',');
          return cols.length > 1 ? cols[1].trim() : '';
        }
        let value = extractFromLine(lines[0]);
        if (!value && lines.length > 1) value = extractFromLine(lines[1]);
        if (!value) {
          const found = csvText.match(/,?\s*(\d{1,})\s*(?:,|\r?\n|$)/);
          value = found ? found[1] : '0';
        }
        document.getElementById("jumlahPerkhidmatan").textContent = value || '0';
      })
      .catch(err => {
        console.warn(err);
        document.getElementById("jumlahPerkhidmatan").textContent = '0';
      });

    // Data cards endpoint
    const dataUrl = "https://script.google.com/macros/s/AKfycbyIDMuRP2Ozt_lx4V_wWYEwPmk3zIhr5LjxFAUzsrdv6E2fiVjEFpLhXmmYh84IzE5ROA/exec";
    let allCards = [];

    fetch(dataUrl)
      .then(r => r.json())
      .then(data => {
        allCards = (data || []).map(row => {
          const norm = {};
          Object.keys(row || {}).forEach(k => {
            norm[k.trim().toLowerCase()] = row[k] != null ? String(row[k]).trim() : '';
          });

          if ((norm["status paparan"] || '').toLowerCase() !== "lulus") return null;
          if (!norm["nama"]) return null;

          const company = escapeHTML(norm["nama syarikat"]);
          const nama = escapeHTML(norm["nama"]);
          const telefon = escapeHTML(norm["nombor telefon syarikat"]);
          const bidang = escapeHTML(norm["bidang"]);
          const subbidang = escapeHTML(norm["sub-bidang"]);
          const butiran = escapeHTML(norm["butiran perkhidmatan"]);
          const picKad = escapeHTML(norm["pic kad"]);
          const statusJawatan = ((norm["kebenaran untuk berkongsi maklumat jawatan"] || '').toLowerCase() === "benarkan")
            ? escapeHTML(norm["status dalam syarikat"] || "-")
            : "-";

          const waText = encodeURIComponent(
            "ğŸ“Œ Kad Perkhidmatan Penduduk Banjaria Court\n\n" +
            "ğŸ‘¤ Nama: " + nama + "\n" +
            (company ? "ğŸ¢ Syarikat: " + company + "\n" : "") +
            (telefon ? "ğŸ“ Telefon: " + telefon + "\n" : "") +
            "ğŸ“‹ Status: " + statusJawatan + "\n" +
            (bidang ? "ğŸ“‚ Bidang: " + bidang + "\n" : "") +
            (subbidang ? "ğŸ“ Sub-bidang: " + subbidang + "\n" : "") +
            (butiran ? "ğŸ“ Butiran: " + butiran + "\n" : "") +
            (picKad ? "ğŸ“ Kad: " + picKad : "")
          );

          const html = `
    <article class="bg-panel border border-gray-100 rounded-xl p-4 shadow-sm flex flex-col">
    ${company ? `<div class="text-black font-extrabold text-xl uppercase tracking-wide mb-1">${company}</div>` : ''}
    <h3 class="text-black font-bold text-lg">${nama}</h3>

    ${telefon ? `<div class="text-sm mt-2"><span class="inline-block bg-accent text-slate-900 font-semibold px-2 py-0.5 rounded-md">Telefon:</span> <span class="text-slate-700 ml-2">${telefon}</span></div>` : ''}

    ${statusJawatan ? `<div class="text-sm mt-2"><span class="inline-block bg-accent text-slate-900 font-semibold px-2 py-0.5 rounded-md">Status:</span> <span class="text-slate-700 ml-2">${statusJawatan}</span></div>` : `<div class="text-sm mt-2"><span class="inline-block bg-accent text-slate-900 font-semibold px-2 py-0.5 rounded-md">Status:</span> <span class="text-slate-700 ml-2">-</span></div>`}

    ${bidang ? `<div class="text-sm mt-2"><span class="inline-block bg-accent text-slate-900 font-semibold px-2 py-0.5 rounded-md">Bidang:</span> <span class="text-slate-700 ml-2">${bidang}</span></div>` : ''}

    ${subbidang ? `<div class="text-sm mt-2"><span class="inline-block bg-accent text-slate-900 font-semibold px-2 py-0.5 rounded-md">Sub-bidang:</span> <span class="text-slate-700 ml-2">${subbidang}</span></div>` : ''}

    ${butiran ? `<p class="mt-3 text-slate-700 text-sm">${butiran}</p>` : ''}

    <div class="mt-4 flex gap-2">
      ${picKad ? `<a href="${picKad}" target="_blank" class="px-3 py-2 bg-accent text-slate-900 rounded-md text-sm font-semibold flex items-center gap-2 border border-accent/20">ğŸ“ Lihat Kad</a>` : ''}
      <a href="https://api.whatsapp.com/send?text=${waText}" target="_blank" class="ml-auto px-3 py-2 bg-accent text-slate-900 rounded-md text-sm font-semibold flex items-center gap-2">ğŸ“¤ Hantar ke WhatsApp</a>
    </div>
    </article>
`.trim();

          return { bidang: norm["bidang"] || '', html };
        }).filter(Boolean);

        // populate bidang select
        const sel = document.getElementById("bidangSelect");
        const bidangSet = new Set(allCards.map(c => c.bidang).filter(Boolean));
        [...bidangSet].sort().forEach(b => {
          const opt = document.createElement('option');
          opt.value = b; opt.textContent = b;
          sel.appendChild(opt);
        });

        renderCards("Semua");
      })
      .catch(e => console.error("Gagal muat kad:", e));

    // filter listener
    document.getElementById("bidangSelect").addEventListener("change", e => renderCards(e.target.value));

    function renderCards(filterBidang) {
      const dir = document.getElementById("directory");
      dir.innerHTML = "";
      const list = filterBidang === "Semua"
        ? allCards
        : allCards.filter(c => (c.bidang || '').toLowerCase() === (filterBidang || '').toLowerCase());

      if (!list.length) {
        dir.innerHTML = '<div class="col-span-full text-center text-slate-600 py-6">Tiada perkhidmatan ditemui untuk pilihan ini.</div>';
        return;
      }

      list.forEach(c => {
        const wrapper = document.createElement('div');
        wrapper.innerHTML = c.html;
        dir.appendChild(wrapper.firstElementChild);
      });
    }

    // share page link to WhatsApp after DOM ready
    document.addEventListener("DOMContentLoaded", () => {
      const shareBtn = document.getElementById("shareLink");
      const pageUrl = window.location.href;
      shareBtn.href = `https://api.whatsapp.com/send?text=${encodeURIComponent('Senarai Perkhidmatan Penduduk: ' + pageUrl)}`;
    });
  </script>
</body>
</html>
