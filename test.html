<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Senarai Perkhidmatan Penduduk</title>
  <link href="https://fonts.googleapis.com/css2?family=Tenorite&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Tenorite', sans-serif; margin:0; padding:0; background:#1a1a1a; }
    h1 {
      text-align:center;
      padding:20px;
      background:#243137;
      color:#bd9f67;
      margin:0;
      font-weight:600;
      letter-spacing:1px;
    }
    .intro {
      text-align: center;
      padding: 15px 20px;
      color: #f0f0f0;
      font-size: 16px;
      background: #2e3b41;
      border-bottom: 1px solid #bd9f67;
    }
    .controls {
      padding:20px;
      text-align:center;
      color:#f0f0f0;
    }
    select {
      padding:8px;
      font-size:16px;
      border-radius:6px;
      border:none;
      background:#bd9f67;
      color:#243137;
      font-weight:bold;
    }
    table {
      margin:20px auto;
      border-collapse:collapse;
      width:80%;
      max-width:500px;
      background:#243137;
      color:#f0f0f0;
    }
    th, td {
      border:1px solid #000;
      padding:10px;
    }
    th {
      background:#bd9f67;
      color:#243137;
      text-align:left;
    }
    td:nth-child(2) {
      text-align:center;
    }
    .container { display:flex; flex-wrap:wrap; justify-content:center; padding:20px; gap:20px; }

    .card {
      width: 300px;
      min-height: 220px;
      background: #243137;
      border-radius: 10px;
      transition: all 0.5s ease-in-out;
      padding: 15px;
      color: #f0f0f0;
      box-sizing: border-box;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(189,159,103,0.6);
    }
    .card p { margin:6px 0; font-size:14px; }

    .company-name {
      font-size: 20px;
      font-weight: bold;
      color: #bd9f67;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .label { font-weight:bold; color:#bd9f67; }

    .btn-link {
      display:inline-block;
      margin-top:8px;
      padding:8px 14px;
      background:#bd9f67;
      color:#243137;
      font-weight:bold;
      border-radius:6px;
      text-decoration:none;
      transition: all 0.3s ease;
    }
    .btn-link:hover {
      background:#e0c78f;
      color:#000;
    }
  </style>
</head>
<body>
  <h1>Senarai Perkhidmatan Penduduk</h1>

  <div class="intro">
    <p><strong>Makluman: Konsultan Profesional Penduduk Banjaria Court</strong></p>
    <p>Ramai dalam kalangan penduduk Banjaria Court memiliki kepakaran dalam pelbagai bidang profesional. Perkhidmatan mereka sering diperlukan oleh komuniti kita.</p>
    <p>Inisiatif ini bertujuan untuk memudahkan pertemuan awal dan rujukan tempatan, menjimatkan masa, serta memberi keyakinan bahawa individu yang disenaraikan adalah pemilik atau penghuni sah. Ia juga membantu mengelakkan penipuan dan menggalakkan semangat kejiranan melalui perkongsian kepakaran.</p>
  </div>

  <div class="controls">
    <label for="bidangSelect">Tapis ikut bidang:</label>
    <select id="bidangSelect">
      <option value="Semua">Semua</option>
    </select>
  </div>

  <table id="statistikTable">
    <thead>
      <tr><th>Bidang</th><th>Jumlah Berdaftar</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><th>Jumlah Keseluruhan</th><th id="totalCount">0</th></tr>
    </tfoot>
  </table>

  <div class="container" id="directory"></div>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const dataUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaIC8vSqefzEVD6ndgQecCNLOb-mNdCtUZMAC_ojDvgDD-mCAnPBVgdLfYlUW7ehK73e8-1KIl4AKZ/pub?gid=1819529203&single=true&output=csv";
    const statistikUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaIC8vSqefzEVD6ndgQecCNLOb-mNdCtUZMAC_ojDvgDD-mCAnPBVgdLfYlUW7ehK73e8-1KIl4AKZ/pub?gid=2034381075&single=true&output=csv";

    let allCards = [];

    Papa.parse(statistikUrl, {
      download: true,
      header: true,
      complete: function(statistikResults) {
        const bidangList = statistikResults.data.filter(row => row["Bidang"]).map(row => row["Bidang"].trim());
        const jumlahList = statistikResults.data.filter(row => row["Bidang"] && row["Jumlah"]);

        const select = document.getElementById("bidangSelect");
        bidangList.forEach(bidang => {
          const option = document.createElement("option");
          option.value = bidang;
          option.textContent = bidang;
          select.appendChild(option);
        });

        const tbody = document.querySelector("#statistikTable tbody");
        let total = 0;
        jumlahList.forEach(row => {
          const bidang = row["Bidang"].trim();
          const jumlah = parseInt(row["Jumlah"]) || 0;
          total += jumlah;
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${bidang}</td><td>${jumlah}</td>`;
          tbody.appendChild(tr);
        });
        document.getElementById("totalCount").textContent = total;
      }
    });

    Papa.parse(dataUrl, {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;
        allCards = data.map((row) => {
          const normalized = {};
          for (let key in row) {
            if (row.hasOwnProperty(key)) {
              normalized[key.trim().toLowerCase()] = row[key]?.trim();
            }
          }

          const statusPaparan = normalized["status paparan"];
          if (!statusPaparan || statusPaparan.toLowerCase() !== "lulus") return null;

          const namaSyarikat = normalized["nama syarikat"];
          const nama = normalized["nama"];
          const telefon = normalized["nombor telefon syarikat"];
          const bidang = normalized["bidang"];
          const subBidang = normalized["sub-bidang"];
          const butiran = normalized["butiran perkhidmatan"];
          const picKad = normalized["pic kad"];
          const status = normalized["status dalam syarikat"];
          const izin = normalized["kebenaran untuk berkongsi maklumat jawatan"];

          let statusDisplay = "-";
          if (izin && izin.toLowerCase() === "benarkan") {
            statusDisplay = status || "-";
          }

          if (!nama) return null;

          return {
            bidang,
            html: `
              <div class="card">
                ${namaSyarikat ? `<div class="company-name">${namaSyarikat}</div>` : ""}
                <p><span class="label">Nama:</span> ${nama}</p>
                ${telefon ? `<p><span class="label">Telefon:</span> ${telefon}</p>` : ""}
                <p><span class="label">Status:</span> ${statusDisplay}</p>
                ${bidang ? `<p><span class="label">Bidang:</span> ${bidang
